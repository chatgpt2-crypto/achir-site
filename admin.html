<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>لوحة تحكم منصة أشير</title>

<style>

body{
font-family:Arial;
background:#f4f6f9;
margin:0;
padding:20px;
}

.box{
background:#fff;
padding:20px;
border-radius:12px;
max-width:1000px;
margin:auto;
box-shadow:0 0 10px rgba(0,0,0,0.1);
}

h2{
text-align:center;
}

.top{
display:flex;
justify-content:space-between;
margin-bottom:10px;
flex-wrap:wrap;
gap:10px;
}

button{
background:#0b1a2e;
color:#fff;
border:none;
padding:8px 14px;
border-radius:6px;
cursor:pointer;
}

button.delete{
background:red;
}

button.refresh{
background:orange;
}

input{
padding:8px;
width:100%;
margin-bottom:10px;
}

table{
width:100%;
border-collapse:collapse;
}

th,td{
padding:10px;
border:1px solid #ddd;
text-align:center;
}

th{
background:#0b1a2e;
color:#fff;
}

.status{
margin-bottom:10px;
}

.login{
max-width:400px;
margin:auto;
}

</style>

</head>
<body>

<div class="box login" id="loginBox">

<h2>تسجيل دخول</h2>

<input id="password" placeholder="كلمة السر">

<button onclick="login()">دخول</button>

</div>


<div class="box" id="adminBox" style="display:none;">

<h2>لوحة تحكم منصة أشير</h2>

<div class="top">

<button onclick="load()" class="refresh">تحديث</button>

<button onclick="logout()">خروج</button>

</div>

<div class="status" id="status">
جاري التحميل...
</div>

<input id="search" placeholder="بحث..." onkeyup="search()">

<table>

<tr>
<th>الاسم</th>
<th>الهاتف</th>
<th>المدينة</th>
<th>نوع الطلب</th>
<th>التاريخ</th>
<th>حذف</th>
</tr>

<tbody id="orders"></tbody>

</table>

</div>



<script>

const BACKEND = "https://achir-backend-1.onrender.com";
const API = BACKEND + "/api/orders";

let DATA = [];


function login(){

let pass = document.getElementById("password").value;

if(pass=="123456"){

localStorage.setItem("admin","ok");

showAdmin();

}

else{

alert("كلمة السر خاطئة");

}

}


function logout(){

localStorage.removeItem("admin");

location.reload();

}


function showAdmin(){

document.getElementById("loginBox").style.display="none";

document.getElementById("adminBox").style.display="block";

load();

}


if(localStorage.getItem("admin")=="ok"){

showAdmin();

}



function load(){

document.getElementById("status").innerHTML="جاري التحميل...";

fetch(API)
.then(r=>r.json())
.then(data=>{

DATA=data;

document.getElementById("status").innerHTML="عدد الطلبات: "+data.length;

render(data);

})
.catch(()=>{

document.getElementById("status").innerHTML="فشل الاتصال";

});

}



function render(list){

let html="";

list.forEach(o=>{

html+=`
<tr>

<td>${o.name||""}</td>

<td>${o.phone||""}</td>

<td>${o.city||""}</td>

<td>${o.type||""}</td>

<td>${o.date||""}</td>

<td>
<button class="delete" onclick="del('${o.id}')">
حذف
</button>
</td>

</tr>
`;

});

document.getElementById("orders").innerHTML=html;

}



function search(){

let s=document.getElementById("search").value.toLowerCase();

let f=DATA.filter(o=>

(o.name||"").toLowerCase().includes(s)
||
(o.phone||"").includes(s)
||
(o.city||"").toLowerCase().includes(s)

);

render(f);

}



function del(id){

if(!confirm("حذف الطلب؟"))return;

fetch(API+"/"+id,{
method:"DELETE"
})
.then(()=>load());

}

</script>


</body>
</html>
