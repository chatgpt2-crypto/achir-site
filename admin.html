<!DOCTYPE html>
<html dir="rtl">
<head>
<meta charset="UTF-8">
<title>لوحة تحكم منصة أشير</title>

<style>

body{
font-family:Arial;
background:#f4f6f9;
margin:0;
padding:20px;
}

.box{
background:#fff;
padding:20px;
border-radius:12px;
max-width:1000px;
margin:auto;
box-shadow:0 0 10px rgba(0,0,0,0.1);
}

h2{
margin-bottom:10px;
}

.top{
display:flex;
gap:10px;
margin-bottom:15px;
flex-wrap:wrap;
}

button{
border:none;
padding:10px 15px;
border-radius:8px;
cursor:pointer;
}

.refresh{
background:#ff7a00;
color:#fff;
}

.logout{
background:#0b1a2e;
color:#fff;
}

.export{
background:#28a745;
color:#fff;
}

input{
padding:10px;
width:100%;
margin-bottom:10px;
border-radius:8px;
border:1px solid #ccc;
}

table{
width:100%;
border-collapse:collapse;
}

th{
background:#0b1a2e;
color:#fff;
padding:10px;
}

td{
padding:10px;
border-bottom:1px solid #ddd;
text-align:center;
}

.delete{
background:red;
color:#fff;
padding:5px 10px;
border-radius:6px;
cursor:pointer;
}

.status{
margin-bottom:10px;
font-weight:bold;
}

.login{
background:#fff;
padding:20px;
border-radius:10px;
max-width:400px;
margin:auto;
box-shadow:0 0 10px rgba(0,0,0,0.1);
}

.login button{
width:100%;
background:#ff7a00;
color:#fff;
}

</style>

</head>
<body>

<div id="loginBox" class="login">

<h3>تسجيل دخول</h3>

<input type="password" id="pass" placeholder="كلمة السر">

<button onclick="login()">دخول</button>

<p id="loginStatus"></p>

</div>


<div id="adminBox" class="box" style="display:none;">

<h2>لوحة تحكم منصة أشير</h2>

<div class="top">

<button class="refresh" onclick="load()">تحديث</button>

<button class="export" onclick="exportCSV()">Export CSV</button>

<button class="logout" onclick="logout()">خروج</button>

</div>

<input id="search" placeholder="بحث بالاسم أو الهاتف أو المدينة" onkeyup="render()">

<p class="status" id="status">جاري التحميل...</p>

<table>

<thead>
<tr>
<th>الاسم</th>
<th>الهاتف</th>
<th>المدينة</th>
<th>نوع الطلب</th>
<th>التاريخ</th>
<th>حذف</th>
</tr>
</thead>

<tbody id="orders"></tbody>

</table>

</div>


<script>

const BACKEND="https://achir-backend-1.onrender.com";
const API=BACKEND+"/api/orders";

let DATA=[];


// login

function login(){

let p=document.getElementById("pass").value;

if(p==="admin47"){

localStorage.setItem("admin","1");

showAdmin();

}else{

document.getElementById("loginStatus").innerHTML="كلمة سر خاطئة";

}

}


// logout

function logout(){

localStorage.removeItem("admin");

location.reload();

}


// show admin

function showAdmin(){

document.getElementById("loginBox").style.display="none";
document.getElementById("adminBox").style.display="block";

load();

}


// load orders

function load(){

document.getElementById("status").innerHTML="جاري التحميل...";

fetch(API)

.then(r=>r.json())

.then(d=>{

DATA=d;

document.getElementById("status").innerHTML="عدد الطلبات: "+d.length;

render();

})

.catch(()=>{

document.getElementById("status").innerHTML="فشل الاتصال بالBackend";

});

}


// render

function render(){

let s=document.getElementById("search").value.toLowerCase();

let html="";

DATA.filter(o=>

(o.name||"").toLowerCase().includes(s)||
(o.phone||"").toLowerCase().includes(s)||
(o.city||"").toLowerCase().includes(s)

).forEach(o=>{

html+=`

<tr>

<td>${o.name||""}</td>
<td>${o.phone||""}</td>
<td>${o.city||""}</td>
<td>${o.type||""}</td>
<td>${o.date||""}</td>

<td>

<button class="delete"
onclick="del('${o.id}')">

حذف

</button>

</td>

</tr>

`;

});

document.getElementById("orders").innerHTML=html;

}


// delete

function del(id){

if(!confirm("حذف الطلب؟")) return;

fetch(API+"/"+id,{method:"DELETE"})
.then(()=>load());

}


// export CSV

function exportCSV(){

let csv="name,phone,city,type,date\n";

DATA.forEach(o=>{

csv+=`${o.name},${o.phone},${o.city},${o.type},${o.date}\n`;

});

let blob=new Blob([csv]);
let a=document.createElement("a");

a.href=URL.createObjectURL(blob);
a.download="orders.csv";

a.click();

}


// auto login

if(localStorage.getItem("admin")){

showAdmin();

}

</script>

</body>
</html>
