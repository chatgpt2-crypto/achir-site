<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>
  <style>
    :root{
      --bg:#f6f7fb; --card:#fff; --text:#111827; --muted:#6b7280;
      --brand:#ff7a00; --brand2:#ff9a3a; --line:#e5e7eb;
      --good:#16a34a; --bad:#dc2626; --dark:#0f172a;
      --shadow: 0 10px 25px rgba(15,23,42,.08);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:var(--bg); color:var(--text);
    }
    .wrap{max-width:1100px; margin:28px auto; padding:0 14px;}
    .top{
      background:linear-gradient(135deg, #ffffff, #ffffff);
      border:1px solid var(--line);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding:18px 18px 14px;
    }
    .title{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      flex-wrap:wrap;
    }
    h1{margin:0; font-size:26px}
    .sub{color:var(--muted); margin-top:6px; font-size:14px}
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:8px 12px; background:#fff; border:1px solid var(--line);
      border-radius:999px; color:var(--muted); font-size:13px;
    }
    .controls{
      margin-top:14px; display:grid; gap:10px;
      grid-template-columns: 160px 1fr 170px;
    }
    @media (max-width: 760px){
      .controls{grid-template-columns:1fr}
    }
    button{
      border:0; cursor:pointer; border-radius:14px;
      padding:12px 14px; font-weight:700; font-size:15px;
    }
    .btn-primary{
      background:linear-gradient(135deg, var(--brand), var(--brand2));
      color:#fff; box-shadow: 0 10px 18px rgba(255,122,0,.18);
    }
    .btn-dark{
      background:var(--dark); color:#fff;
      box-shadow: 0 10px 18px rgba(2,6,23,.18);
    }
    .btn-ghost{
      background:#fff; border:1px solid var(--line); color:var(--text);
    }
    input, select{
      width:100%; border:1px solid var(--line); border-radius:14px;
      padding:12px 14px; font-size:15px; outline:none; background:#fff;
    }
    input:focus, select:focus{border-color:#cbd5e1; box-shadow:0 0 0 4px rgba(59,130,246,.08)}
    .meta{
      margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      color:var(--muted); font-size:14px;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border-radius:999px; background:#fff;
      border:1px solid var(--line);
    }
    .badge strong{color:var(--text)}
    .ok{color:var(--good); font-weight:800}
    .err{color:var(--bad); font-weight:800}
    .grid{
      margin-top:16px;
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:12px;
    }
    @media (max-width: 900px){
      .grid{grid-template-columns:1fr}
    }
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
    }
    .row{display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap}
    .id{
      font-weight:900; color:var(--muted);
      background:#f3f4f6; border:1px dashed #e5e7eb;
      padding:6px 10px; border-radius:999px;
    }
    .status{
      padding:6px 10px; border-radius:999px; font-weight:800; font-size:13px;
      border:1px solid var(--line); background:#fff;
    }
    .s-new{color:#0ea5e9}
    .s-work{color:#f59e0b}
    .s-done{color:#16a34a}
    .k{color:var(--muted); font-size:13px; margin-top:10px}
    .v{font-size:18px; font-weight:900; margin-top:4px; word-break:break-word}
    .two{
      display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:10px;
    }
    @media (max-width: 520px){ .two{grid-template-columns:1fr} }
    .actions{
      margin-top:12px;
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .btn-wa{
      background:#25D366; color:#fff; font-weight:900;
      box-shadow: 0 10px 18px rgba(37,211,102,.18);
    }
    .btn-del{
      background:#fff; border:1px solid #fecaca; color:#b91c1c;
      font-weight:900;
    }
    .hint{margin-top:12px; color:var(--muted); font-size:13px; line-height:1.6}
    .footer{
      margin-top:16px; text-align:center; color:var(--muted); font-size:12px;
    }
    .small{font-size:12px; color:var(--muted)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;}
    .divider{height:1px; background:var(--line); margin:14px 0}
  </style>
</head>
<body>
<script>
  // ====== Ø­Ù…Ø§ÙŠØ© Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Client-side) ======
  const ADMIN_PASSWORD = "ACHIR2026";   // ØºÙŠÙ‘Ø±Ù‡Ø§ Ù„ÙƒÙ„Ù…Ø© Ø³Ø± Ù‚ÙˆÙŠØ©
  const LOGIN_KEY = "achir_admin_ok_v1";

  function showLogin() {
    document.body.innerHTML = `
      <div style="min-height:100vh;display:flex;align-items:center;justify-content:center;padding:16px;background:#f6f7fb;font-family:system-ui,Tahoma,Arial">
        <div style="width:min(420px,100%);background:#fff;border:1px solid #e5e7eb;border-radius:18px;box-shadow:0 10px 25px rgba(15,23,42,.08);padding:18px">
          <h2 style="margin:0 0 10px">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
          <p style="margin:0 0 14px;color:#6b7280;font-size:14px">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„Ø¯Ø®ÙˆÙ„</p>
          <input id="pass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" style="width:100%;padding:12px 14px;border:1px solid #e5e7eb;border-radius:14px;font-size:15px;outline:none" />
          <button id="go" style="margin-top:12px;width:100%;padding:12px 14px;border:0;border-radius:14px;background:#ff7a00;color:#fff;font-weight:800;cursor:pointer">Ø¯Ø®ÙˆÙ„</button>
          <div id="err" style="margin-top:10px;color:#dc2626;font-weight:700"></div>
        </div>
      </div>
    `;

    const passEl = document.getElementById("pass");
    const errEl = document.getElementById("err");
    const goBtn = document.getElementById("go");

    function tryLogin(){
      const v = (passEl.value || "").trim();
      if (v === ADMIN_PASSWORD) {
        sessionStorage.setItem(LOGIN_KEY, "1");
        location.reload();
      } else {
        errEl.textContent = "ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø§Ø·Ø¦Ø©";
      }
    }

    goBtn.onclick = tryLogin;
    passEl.addEventListener("keydown", (e)=>{ if(e.key==="Enter") tryLogin(); });
  }

  // Ù„Ùˆ Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ØŒ ÙƒÙ…Ù„ Ø§Ù„ØµÙØ­Ø© Ø¹Ø§Ø¯ÙŠ
  if (sessionStorage.getItem(LOGIN_KEY) !== "1") {
    showLogin();
    // Ù†ÙˆÙ‚Ù Ø£ÙŠ Ø³ÙƒØ±Ø¨ØªØ§Øª Ø£Ø®Ø±Ù‰ Ù…Ù† Ø§Ù„ØªØ­Ù…ÙŠÙ„
    throw new Error("Not logged in");
  }
</script>
  
  <div class="wrap">
    <div class="top">
      <div class="title">
        <div>
          <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>
          <div class="sub">
            Backend:
            <span class="mono" id="backendLabel">â€”</span>
          </div>
        </div>
        <div class="pill">
          â±ï¸ ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ <strong>7 Ø«</strong>
        </div>
      </div>

      <div class="controls">
        <button class="btn-primary" id="refreshBtn">ØªØ­Ø¯ÙŠØ«</button>
        <input id="search" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… / Ø§Ù„Ù‡Ø§ØªÙ / Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© / Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©..." />
        <select id="filterStatus">
          <option value="all">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
          <option value="new">Ø¬Ø¯ÙŠØ¯</option>
          <option value="working">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
          <option value="done">Ù…ÙƒØªÙ…Ù„</option>
        </select>
      </div>

      <div class="meta">
        <span class="badge">ğŸ“¦ ØªÙ… Ø¬Ù„Ø¨: <strong id="count">0</strong> Ø·Ù„Ø¨</span>
        <span class="badge">ğŸ•’ Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <strong id="last">â€”</strong></span>
        <span class="badge">ğŸ“¡ Ø§Ù„Ø­Ø§Ù„Ø©: <strong id="state" class="ok">Ø¬Ø§Ù‡Ø²</strong></span>
      </div>

      <div class="hint">
        âœ… Ø§Ø¶ØºØ· <b>ØªØ­Ø¯ÙŠØ«</b> Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª.  
        âœ… Ø²Ø± <b>ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨</b> ÙŠÙØªØ­ Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø±Ù‚Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†.  
        âœ… ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ (Ø¬Ø¯ÙŠØ¯ / Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© / Ù…ÙƒØªÙ…Ù„).  
        âœ… Ø²Ø± <b>Ø­Ø°Ù</b> ÙŠØ­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.
      </div>
    </div>

    <div class="grid" id="list"></div>

    <div class="footer">
      Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø£Ø´ÙŠØ± â€” ØªØµÙ…ÙŠÙ… Ø®ÙÙŠÙ ÙˆÙ…ØªØ¬Ø§ÙˆØ¨ Ù„Ù„Ø¬ÙˆØ§Ù„ ÙˆØ§Ù„ÙˆÙŠØ¨
    </div>
  </div>

  <script>
    // âœ… Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ Backend Ù‡Ù†Ø§ (Ù†ÙØ³ Ø§Ù„Ø°ÙŠ Ø¹Ù†Ø¯Ùƒ Ø¹Ù„Ù‰ Render)
    const BACKEND = "https://achir-backend.onrender.com";
    document.getElementById("backendLabel").textContent = BACKEND;

    // âœ… Ù…Ø³Ø§Ø±Ø§Øª API (Ø¹Ø¯Ù‘Ù„Ù‡Ø§ Ù„Ùˆ ÙƒØ§Ù†Øª Ù…Ø®ØªÙ„ÙØ©)
    const API_LIST   = `${BACKEND}/api/orders`;
    const API_DELETE = (id) => `${BACKEND}/api/orders/${id}`;
    const API_STATUS = (id) => `${BACKEND}/api/orders/${id}/status`; // Ø³Ù†Ø³ØªØ¹Ù…Ù„Ù‡Ø§ Ø¥Ù† ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©

    const elList  = document.getElementById("list");
    const elCount = document.getElementById("count");
    const elLast  = document.getElementById("last");
    const elState = document.getElementById("state");

    const elSearch = document.getElementById("search");
    const elFilter = document.getElementById("filterStatus");
    const elRefresh = document.getElementById("refreshBtn");

    let allOrders = [];
    let timer = null;

    function setState(ok, msg){
      elState.textContent = msg;
      elState.className = ok ? "ok" : "err";
    }

    function formatDate(s){
      if(!s) return "â€”";
      // Ø¯Ø¹Ù… ØµÙŠØº: "2026-02-07 13:21:02" Ø£Ùˆ ISO
      const d = new Date(String(s).replace(" ", "T"));
      if (isNaN(d.getTime())) return String(s);
      return d.toLocaleString("ar-DZ");
    }

    function statusLabel(val){
      if(val === "working") return {txt:"Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©", cls:"s-work"};
      if(val === "done") return {txt:"Ù…ÙƒØªÙ…Ù„", cls:"s-done"};
      return {txt:"Ø¬Ø¯ÙŠØ¯", cls:"s-new"};
    }

    function normalizePhone(phone){
      let p = (phone || "").toString().trim();
      p = p.replace(/\s+/g,"");
      // Ù„Ùˆ Ø±Ù‚Ù… ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 0 Ù†Ø­ÙˆÙ„Ù‡ Ù„ 213
      if(p.startsWith("0")) p = "213" + p.slice(1);
      // Ù„Ùˆ ÙŠØ¨Ø¯Ø£ Ø¨Ù€ + Ù†Ø­Ø°Ù +
      if(p.startsWith("+")) p = p.slice(1);
      return p;
    }

    function matches(order, q){
      if(!q) return true;
      q = q.toLowerCase();
      const hay = [
        order.id,
        order.name,
        order.phone,
        order.city,
        order.note,
        order.created_at,
        order.status
      ].map(x => (x ?? "").toString().toLowerCase()).join(" ");
      return hay.includes(q);
    }

    function filterOrders(){
      const q = elSearch.value.trim();
      const fs = elFilter.value;

      return allOrders.filter(o => {
        const okSearch = matches(o, q);
        const okStatus = (fs === "all") ? true : ((o.status || "new") === fs);
        return okSearch && okStatus;
      });
    }

    function render(){
      const items = filterOrders();
      elCount.textContent = items.length;

      if(!items.length){
        elList.innerHTML = `
          <div class="card">
            <div class="row">
              <div style="font-weight:900">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯...</div>
              <div class="small">Ø¬Ø±Ù‘Ø¨ ØªØ­Ø¯ÙŠØ« Ø£Ùˆ Ù…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø«</div>
            </div>
          </div>`;
        return;
      }

      elList.innerHTML = items.map(o => {
        const st = statusLabel(o.status || "new");
        const wa = "https://wa.me/" + normalizePhone(o.phone);
        return `
          <div class="card" data-id="${o.id}">
            <div class="row">
              <div class="id"># ${o.id}</div>
              <div class="status ${st.cls}">${st.txt}</div>
            </div>

            <div class="two">
              <div>
                <div class="k">Ø§Ù„Ø§Ø³Ù…</div>
                <div class="v">${escapeHtml(o.name || "")}</div>
              </div>
              <div>
                <div class="k">Ø§Ù„Ù‡Ø§ØªÙ</div>
                <div class="v mono">${escapeHtml(o.phone || "")}</div>
              </div>
            </div>

            <div class="two">
              <div>
                <div class="k">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</div>
                <div class="v">${escapeHtml(o.city || "")}</div>
              </div>
              <div>
                <div class="k">Ø§Ù„ØªØ§Ø±ÙŠØ®</div>
                <div class="v">${escapeHtml(formatDate(o.created_at))}</div>
              </div>
            </div>

            <div class="divider"></div>

            <div class="k">Ù…Ù„Ø§Ø­Ø¸Ø©</div>
            <div class="v" style="font-size:16px">${escapeHtml(o.note || "â€”")}</div>

            <div class="actions">
              <a class="btn-wa" style="padding:12px 14px;border-radius:14px;text-decoration:none;color:#fff;font-weight:900" target="_blank" href="${wa}">
                ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨
              </a>

              <button class="btn-ghost" onclick="copyText('${escapeJs(o.phone || "")}')">Ù†Ø³Ø® Ø§Ù„Ù‡Ø§ØªÙ</button>

              <select onchange="changeStatus(${o.id}, this.value)" class="btn-ghost" style="min-width:170px">
                <option value="new" ${((o.status||"new")==="new")?"selected":""}>Ø¬Ø¯ÙŠØ¯</option>
                <option value="working" ${((o.status||"new")==="working")?"selected":""}>Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                <option value="done" ${((o.status||"new")==="done")?"selected":""}>Ù…ÙƒØªÙ…Ù„</option>
              </select>

              <button class="btn-del" onclick="deleteOrder(${o.id})">Ø­Ø°Ù</button>
            </div>
          </div>
        `;
      }).join("");
    }

    async function fetchOrders(){
      try{
        setState(true, "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¬Ù„Ø¨...");
        const res = await fetch(API_LIST, { cache:"no-store" });
        if(!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();

        // ØªÙˆÙ‚Ø¹: array
        allOrders = Array.isArray(data) ? data : (data.orders || []);
        // Ù„Ùˆ Ù…Ø§ ÙŠÙˆØ¬Ø¯ statusØŒ Ù†Ø®Ù„ÙŠÙ‡ new
        allOrders = allOrders.map(x => ({...x, status: x.status || "new"}));

        elLast.textContent = new Date().toLocaleString("ar-DZ");
        setState(true, "ØªÙ…");
        render();
      }catch(e){
        console.error(e);
        setState(false, "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„");
        elList.innerHTML = `
          <div class="card">
            <div class="row">
              <div style="font-weight:900">ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
              <div class="small mono">${escapeHtml(String(e.message || e))}</div>
            </div>
            <div class="hint">
              ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ØµØ­ÙŠØ­: <span class="mono">${escapeHtml(API_LIST)}</span><br/>
              ÙˆÙ‚Ø¯ ØªØ­ØªØ§Ø¬ ØªÙØ¹ÙŠÙ„ CORS ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±.
            </div>
          </div>`;
      }
    }

    async function deleteOrder(id){
      if(!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ø±Ù‚Ù… " + id + " ØŸ")) return;

      try{
        const res = await fetch(API_DELETE(id), { method:"DELETE" });
        if(!res.ok) throw new Error("HTTP " + res.status);

        // Ø­Ø°Ù Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙˆØ±Ø§Ù‹
        allOrders = allOrders.filter(x => Number(x.id) !== Number(id));
        render();
        alert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ âœ…");
      }catch(e){
        alert("ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ âŒ\n" + (e.message || e));
      }
    }

    // âœ… ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©:
    // - Ø¥Ø°Ø§ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¹Ù†Ø¯Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³Ø§Ø±ØŒ Ø³Ù†Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ (localStorage)
    async function changeStatus(id, status){
      // 1) Ø­Ø§ÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±
      try{
        const res = await fetch(API_STATUS(id), {
          method:"PUT",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ status })
        });

        if(res.ok){
          // Ø­Ø¯Ø« Ù…Ø­Ù„ÙŠØ§Ù‹
          allOrders = allOrders.map(o => (Number(o.id)===Number(id) ? {...o, status} : o));
          render();
          return;
        }
        // Ù„Ùˆ ÙØ´Ù„ØŒ Ù†ÙƒÙ…Ù„ Ù„Ù„Ù€ localStorage
      }catch(e){}

      // 2) fallback: localStorage
      const key = "orderStatusMap";
      const map = JSON.parse(localStorage.getItem(key) || "{}");
      map[id] = status;
      localStorage.setItem(key, JSON.stringify(map));

      allOrders = allOrders.map(o => (Number(o.id)===Number(id) ? {...o, status} : o));
      render();
    }

    // Ø¹Ù†Ø¯ Ø§Ù„Ø¬Ù„Ø¨ØŒ Ø·Ø¨Ù‚ Ø­Ø§Ù„Ø§Øª localStorage Ø¥Ù† ÙˆØ¬Ø¯Øª (ÙÙŠ Ø­Ø§Ù„ Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„Ø§ ÙŠØ¯Ø¹Ù… status)
    function applyLocalStatus(){
      const map = JSON.parse(localStorage.getItem("orderStatusMap") || "{}");
      allOrders = allOrders.map(o => {
        const s = map[o.id];
        return s ? {...o, status:s} : o;
      });
    }

    function copyText(txt){
      navigator.clipboard.writeText(txt).then(()=> alert("ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ…"));
    }

    function escapeHtml(str){
      return (str ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function escapeJs(str){
      return (str ?? "").toString()
        .replaceAll("\\","\\\\")
        .replaceAll("'","\\'")
        .replaceAll('"','\\"');
    }

    // Ø£Ø­Ø¯Ø§Ø«
    elRefresh.addEventListener("click", async ()=>{
      await fetchOrders();
      applyLocalStatus();
      render();
    });

    elSearch.addEventListener("input", render);
    elFilter.addEventListener("change", render);

    // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ Ù…Ø±Ø© + ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ
    (async function init(){
      await fetchOrders();
      applyLocalStatus();
      render();

      timer = setInterval(async ()=>{
        await fetchOrders();
        applyLocalStatus();
        render();
      }, 7000);
    })();
  </script>
</body>
</html>
