<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>منصة أشير - طلب خدمة</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b1220;
      --card:#ffffff;
      --muted:#6b7280;
      --text:#0f172a;
      --brand:#ff7a00;
      --brand2:#16a34a;
      --line:#e5e7eb;
      --shadow: 0 20px 60px rgba(0,0,0,.18);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Cairo", system-ui, -apple-system, Segoe UI, Arial;
      color:var(--text);
      background:
        radial-gradient(900px 400px at 10% 10%, rgba(255,122,0,.18), transparent 55%),
        radial-gradient(900px 400px at 90% 30%, rgba(22,163,74,.14), transparent 55%),
        linear-gradient(180deg, #071021, #0b1220 60%, #f6f7fb 60%, #f6f7fb);
      min-height:100vh;
    }
    header{
      background: linear-gradient(135deg, #071021, #0b1630);
      color:#fff;
      padding:20px 16px 26px;
      position:sticky; top:0; z-index:10;
      box-shadow: 0 10px 40px rgba(0,0,0,.25);
    }
    .wrap{max-width:980px;margin:0 auto;padding:0 12px;}
    .topbar{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
    }
    .logo{
      width:44px;height:44px;border-radius:14px;
      background: linear-gradient(135deg, var(--brand), #ffb000);
      display:grid; place-items:center;
      font-weight:900;
      box-shadow: 0 10px 25px rgba(255,122,0,.35);
    }
    .brand h1{margin:0;font-size:18px;font-weight:800;letter-spacing:.2px}
    .brand p{margin:0;color:rgba(255,255,255,.75);font-size:12px}
    .navbtn{
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color:#fff;
      padding:10px 14px;border-radius:14px;
      font-weight:800;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex;gap:10px;align-items:center;
    }
    main{padding:18px 0 60px;}
    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.7);
    }
    .cardhead{
      padding:18px 18px 12px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(180deg, #ffffff, #fff7ef);
    }
    .cardhead h2{margin:0;font-size:20px;font-weight:900}
    .cardhead p{margin:6px 0 0;color:var(--muted);font-size:13px}
    form{padding:18px;display:grid;gap:14px}
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    label{font-size:13px;color:#111827;font-weight:800}
    input, select, textarea{
      width:100%;
      padding:12px 14px;
      border:1px solid var(--line);
      border-radius:14px;
      outline:none;
      font-family:inherit;
      font-size:14px;
      background:#fff;
      transition:.2s;
    }
    textarea{min-height:110px;resize:vertical}
    input:focus, select:focus, textarea:focus{border-color: rgba(255,122,0,.6); box-shadow: 0 0 0 4px rgba(255,122,0,.12)}
    .actions{
      display:flex; gap:12px; align-items:center; justify-content:flex-start; flex-wrap:wrap;
      padding-top:4px;
    }
    .btn{
      border:0; cursor:pointer; font-weight:900; border-radius:16px;
      padding:12px 16px; font-family:inherit;
      display:inline-flex; align-items:center; gap:10px;
    }
    .btn.primary{background:var(--brand);color:#fff; box-shadow: 0 12px 30px rgba(255,122,0,.25)}
    .btn.green{background:var(--brand2);color:#fff; box-shadow: 0 12px 30px rgba(22,163,74,.25)}
    .btn.ghost{background:#fff;border:1px solid var(--line);color:#111827}
    .status{
      margin-top:6px;
      font-size:13px;
      padding:12px 14px;
      border-radius:14px;
      border:1px dashed var(--line);
      color:#111827;
      background:#fafafa;
    }
    .status.ok{border-color: rgba(22,163,74,.35); background: rgba(22,163,74,.08)}
    .status.err{border-color: rgba(220,38,38,.35); background: rgba(220,38,38,.08); color:#7f1d1d}
    .footnote{
      margin-top:10px;
      color:#6b7280;font-size:12px;
      display:flex;justify-content:center;gap:6px;flex-wrap:wrap;
    }
    code{background:#111827; color:#fff; padding:3px 8px;border-radius:10px;font-size:12px}
    @media (max-width:740px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo">A</div>
        <div>
          <h1>منصة أشير</h1>
          <p>إرسال طلب مباشر للوحة التحكم</p>
        </div>
      </div>
      <a class="navbtn" href="./admin.html">لوحة التحكم</a>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <div class="card">
      <div class="cardhead">
        <h2>نموذج الطلب</h2>
        <p>املأ البيانات ثم اضغط إرسال. سيتم حفظ الطلب مباشرة في الـ Backend.</p>
      </div>

      <form id="orderForm">
        <div class="grid">
          <div>
            <label>الاسم</label>
            <input name="name" placeholder="مثال: أحمد" required />
          </div>
          <div>
            <label>الهاتف</label>
            <input name="phone" placeholder="مثال: 0666xxxxxx" required />
          </div>
          <div>
            <label>المدينة</label>
            <input name="city" placeholder="مثال: غرداية" required />
          </div>
          <div>
            <label>نوع الطلب</label>
            <select name="type" required>
              <option value="طلب خدمة" selected>طلب خدمة</option>
              <option value="استفسار">استفسار</option>
              <option value="طلب عرض سعر">طلب عرض سعر</option>
              <option value="شكوى">شكوى</option>
            </select>
          </div>
        </div>

        <div>
          <label>ملاحظة</label>
          <textarea name="note" placeholder="اكتب تفاصيل الطلب..."></textarea>
        </div>

        <div class="actions">
          <button class="btn primary" type="submit">إرسال الطلب</button>
          <button class="btn ghost" type="button" id="demoBtn">إضافة بيانات تجريبية</button>
          <button class="btn green" type="button" id="pingBtn">اختبار Backend</button>
        </div>

        <div id="status" class="status">جاهز للإرسال…</div>
        <div class="footnote">
          Backend:
          <code id="backendText"></code>
        </div>
      </form>
    </div>
  </div>
</main>

<script>
  // ✅ ضع رابط الـ backend هنا
  const BACKEND_URL = "https://achir-backend-1.onrender.com";

  // ✅ مسارات API (سنستخدم /api)
  const API = {
    ping: `${BACKEND_URL}/api/health`,
    createOrder: `${BACKEND_URL}/api/orders`
  };

  const statusEl = document.getElementById("status");
  const backendText = document.getElementById("backendText");
  backendText.textContent = BACKEND_URL;

  function setStatus(msg, type=""){
    statusEl.className = "status" + (type ? " " + type : "");
    statusEl.innerHTML = msg;
  }

  document.getElementById("demoBtn").addEventListener("click", () => {
    const f = document.getElementById("orderForm");
    f.name.value = "أحمد";
    f.phone.value = "0666376417";
    f.city.value = "غرداية";
    f.type.value = "طلب خدمة";
    f.note.value = "هذه تجربة إرسال طلب من منصة أشير.";
    setStatus("تمت إضافة بيانات تجريبية ✅");
  });

  document.getElementById("pingBtn").addEventListener("click", async () => {
    try{
      setStatus("جاري اختبار الـ Backend ... ⏳");
      const r = await fetch(API.ping);
      const j = await r.json();
      setStatus(`نجح الاتصال ✅: ${j.message || "OK"}`, "ok");
    }catch(e){
      setStatus(`فشل الاتصال ❌ تأكد من رابط الـ Backend و CORS. <br>${e}`, "err");
    }
  });

  document.getElementById("orderForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const f = e.target;

    const payload = {
      name: f.name.value.trim(),
      phone: f.phone.value.trim(),
      city: f.city.value.trim(),
      type: f.type.value,
      note: f.note.value.trim()
    };

    if(!payload.name || !payload.phone || !payload.city){
      setStatus("املأ الاسم/الهاتف/المدينة ❌", "err");
      return;
    }

    try{
      setStatus("جاري إرسال الطلب... ⏳");
      const r = await fetch(API.createOrder, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });

      const text = await r.text();
      let data;
      try{ data = JSON.parse(text); }catch{ data = {raw:text}; }

      if(!r.ok){
        setStatus(`فشل الإرسال ❌ <br>HTTP ${r.status} <br>${data.message || data.raw || ""}`, "err");
        return;
      }

      setStatus("تم إرسال الطلب بنجاح ✅ سيتم ظهوره في لوحة التحكم.", "ok");
      f.reset();
    }catch(err){
      setStatus(`خطأ اتصال ❌ <br>${err}`, "err");
    }
  });
</script>
</body>
</html>
